doctype html
head
  meta(charset='UTF-8')
  meta(http-equiv='X-UA-Compatible' content='IE=edge')
  meta(name='viewport' content='width=device-width, initial-scale=1.0')
  style 
    include crud.css
    include common.css
  script(src='logik.js')
  script.

    let aktuelGroupNr;

    document.addEventListener('DOMContentLoaded',()=>{
      document
        .getElementById('produktList')
        .addEventListener('input', handleSelect)
    });

    function handleSelect (ev){
      let chosenProduckGoup = ev.target.value;
      result = chosenProduckGoup.split(" ");
      index = result.length - 1;
      aktuelGroupNr = result[index];
      console.log(aktuelGroupNr);
      produktsInGroup(aktuelGroupNr);
    //- each data in produkter
    //-     if data.produktgruppe == "chosenProduckGoup"
    //-       option()= 'Navn: ' + data.navn
    }

    let produktsInGroup = async (aktuelGroupNr) => {
      try {
        await post("/seachProduktinGroup", {valgtGruppeNr: aktuelGroupNr});
        window.location.href = "/CRUD"
      }catch(e){
        console.log("Fejl");
      }
    }

    //Post metode til funktion. 
    async function post(url, objekt) {
      const respons = await fetch(url, {
        method: "POST",
        body: JSON.stringify(objekt),
        headers: {
        'Content-Type': 'application/json'
      }
    });
    if (respons.status !== 201) // Created
      throw new Error(respons.status);
    return await respons.text();
    }

    let createProductgroup = async () => {
      var produktGruppeNavn = document.getElementById("navnG").value;
      var produktGruppeBeskrivelse = document.getElementById("beskrilseG").value;
      try {
        await post("/opretProduktGruppe", {produktGruppeNavn: produktGruppeNavn, produktGruppeBeskrivelse: produktGruppeBeskrivelse});
        window.location.href = "/CRUD"
      }catch(e){
        console.log("Fejl");
      } 
    }

    let deleteProductGroup = async (x) => {
      console.log("Når her til")
      console.log(x)
      try {
        await post("/deleteProduktGroup", {aktuelGroupNr: x});
        window.location.href = "/CRUD"
      }catch(e){
        console.log("Fejl");
      } 
    }
  title PaperSign
.tabbtn
  form(action = "/kasse" method="get")
    input(class="button" type="submit" value="Kasse")
  form(action = "/faktura" method="get")
    input(class="button" type="submit" value="Faktura")
  form(action= "/crud" method="get")
    input(class="button" type="submit" value="Crud")
h1 PaperSign CRUD
.parent
  .child1
    input#atribut(type='text' placeholder='Kategori')
    input#value(type='text' placeholder='Værdi')
    button S&oslash;g
    p#titleP Produktgrupper
    select#produktList(name='kurv' multiple='')
      each data in produktgrupper
        option(onclick="alert("+data.gruppeNr+")")= data.navn + " "+ data.gruppeNr
        //option(value="" placeholder="")= 'Navn: ' + data.navn
    button#tilfoejProduktG(onclick='createProductgroup()') Tilf&oslash;j
    button#tilfoejProduktG Opdater
    button#sletProduktG(onclick='deleteProductGroup()') slet
    input#navnG(type='text' placeholder='Navn')
    input#beskrilseG(type='text' placeholder='Beskrivelse')
  .child2
    p#titleB  
    p#titleK Produkter
    select#kurvList(name='kurv' multiple='')
      each data in ProduktInProduktGoup
          option()= 'Navn: ' + data.navn
          //option(value="" placeholder="")= 'Navn: ' + data.navn
    button#tilfoejProdukt(onclick='createProduct(navn.value, pris.value, antal.value, EAN.value, leverandør.value, bestillingsnummer.value, produktList.selected.value)') Tilf&oslash;j
    button#tilfoejProdukt Opdater
    button#tilfoejProdukt Slet
    input#navn(type='text' placeholder='Navn')
    input#pris(type='text' placeholder='Pris')
    input#antal(type='text' placeholder='Antal')
    input#ean(type='text' placeholder='EAN')
    input(type='text' id='leverandør' placeholder='Leverandør')
    input#bestillingsnummer(type='text' placeholder='Bestillingsnummer')
    input#tilfoejAtr(type='text' placeholder='Skriv tekst her')
    button#tilfoejAtrBut Tilf&oslash;j
