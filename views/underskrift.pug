doctype html
head
  meta(charset='utf-8')
  meta(name='viewport' content='width=device-width, initial-scale=1')
  title Signature
  style 
    include underskrift.css
    include common.css
  link(href='https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css' rel='stylesheet' integrity='sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi' crossorigin='anonymous')
.tabbtn
  form(action = "/kasse" method="get")
    input(class="button" type="submit" value="Kasse")
  form(action = "/faktura" method="get")
    input(class="button" type="submit" value="Faktura")
  form(action= "/crud" method="get")
    input(class="button" type="submit" value="Crud")
#app.container
  div
    canvas#sig
div
  input#text(type='text' placeholder='navn' required='')
  button#gemSig.gem(type='button') gem
  button#sletSig.slet(type='button') slet

  #content
    .parent
      .child1
        p#titleP OrdreLinjer
        #produktList(name='kurv')
          each k of kurv
            div(value=k.navn)= k.antal +'stk.' + k.navn + '' + k.pris+'Total:' + k.total
        input(type="text" placeholder="00kr" disabled)
  #image
  script(src='https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js' integrity='sha512-cLuyDTDg9CSseBSFWNd4wkEaZ0TBEpclX0zD3D6HjI19pO39M58AgJ1SjHp6c7ZOp0/OCRcC2BCvvySU9KJaGw==' crossorigin='anonymous' referrerpolicy='no-referrer')
  script(src='https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js')
  script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js' integrity='sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3' crossorigin='anonymous')
  script(src='https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js' integrity='sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3' crossorigin='anonymous')
  script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js' integrity='sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk' crossorigin='anonymous')
  script(src='https://html2canvas.hertzen.com/dist/html2canvas.min.js')
  script(type='module').
    let count =0;
    var signaturePad
    var canvas;
    function setupSigBox(){
    canvas = document.querySelector("canvas");
    signaturePad = new SignaturePad(canvas);
    }
    document.addEventListener("DOMContentLoaded",setupSigBox);
    function clearSig(){
    signaturePad.clear()
    }
    document.getElementById("sletSig").addEventListener("click",clearSig)
    // gem funktion skal håndteres af express før den virker rigtig
    var button= document.getElementById("gemSig")
    button.onclick=()=>{
    var pdf = new jsPDF("p", "mm", "a4");
    var imageData= signaturePad.toDataURL();
    var text="Navn: "+document.getElementById("text").value
    var pageHeight= pdf.internal.pageSize.height;
    
  
    pdf.html(document.getElementById('content'), {
    html2canvas: {
    scale: [0.60],
    x: -20,
    y: 20,
    letterRendering:true,

    },
    callback: function (pdf) {
    var pageCount = pdf.internal.getNumberOfPages();
    pdf.deletePage(pageCount)
    var pageCount2= pdf.internal.getNumberOfPages();
    pdf.deletePage(pageCount2)
    pdf.text(52,10,text)
    pdf.addImage(imageData,"JPEG",60,200,80,80)
    // total pris skal have en egentlig total pris.
    // text i pdf.save skal være ordrenr istedet
    pdf.save(`${text}.pdf`);
    }
    })
    }
